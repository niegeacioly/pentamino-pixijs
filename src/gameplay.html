<!DOCTYPE html>
<html lang="pt-br">
    <head>
      <!-- Required meta tags -->
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

      <!-- Bootstrap CSS -->
      <!-- integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" -->
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" crossorigin="anonymous">
      <link rel="stylesheet" href="gameplay.css">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/4.5.1/pixi.min.js"></script>
      <script src="../bin/scaleToWindow.js"></script>
      <script src="../bin/pixi-display.js"></script>
      <link href="https://fonts.googleapis.com/css?family=Exo+2" rel="stylesheet"> 
      <title>Game Play</title>
      </head>
      <body>

          <script type="text/javascript">
                // // Load them google fonts before starting...!
                // window.WebFontConfig = {
                //     google: {
                //         families: ['Snippet', 'Arvo:700italic', 'Podkova:700']
                //     },

                //     active: function() {
                //         // do something
                //         // init();
                //     }
                // };

                // include the web-font loader script
                /* jshint ignore:start */
                // (function() {
                //     var wf = document.createElement('script');
                //     wf.src = ('https:' === document.location.protocol ? 'https' : 'http') +
                //         '://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js';
                //     wf.type = 'text/javascript';
                //     wf.async = 'true';
                //     var s = document.getElementsByTagName('script')[0];
                //     s.parentNode.insertBefore(wf, s);
                // })();

                //Aliases
                    var Container = PIXI.Container,
                        autoDetectRenderer = PIXI.autoDetectRenderer,
                        loader = PIXI.loader,
                        resources = PIXI.loader.resources,
                        Sprite = PIXI.Sprite;

                    var stage = new Container(), renderer = autoDetectRenderer(1000, 700, { antialias: true }, true);

                    //specify display list component
                    stage.displayList = new PIXI.DisplayList();
                    
                    // z-index = 0, sorting = true;
                    var letterLayer = new PIXI.DisplayGroup(0, true);
                    letterLayer.on('add', function (sprite) {
                        //green bunnies go down
                        sprite.zOrder = -sprite.position.y;
                    });
                    // Drag is the best layer, dragged element is above everything else
                    var dragLayer = new PIXI.DisplayGroup(2, false);

                    renderer.view.style.border = "1px dashed black";
                    renderer.backgroundColor = 0x232325;

                    var matrixGrid = new Array();
                    var KeyPress = 0;
                    var currentGrid = null, gridWinner = null, winnerGridGraphics = null;
                    
                    var minPixel = 3, defaultIndentation = 20;

                    const GRID_INDENTATION = 200, MINI_GRID_INDENDATION = 50, GRID_INDENTATION_Y = 140, GRID_WIDTH = 890, GRID_HEIGHT = 270, DEFAULT_SIZE_BLOCK = 40;

                    document.body.appendChild(renderer.view);                  
                    document.onkeypress = function(evt) {
                        KeyPress = keyPressed(evt);
                    };
                    document.onkeyup = function(evt) {
                        KeyPress = 0;
                    };

                    var gridHeight = 0;
                    var rowSelected = 6, columnSelected = 10;

                    var rectGridGraphics = null, rectMiniGridGraphics = null, rectModalBackground = null, rectModalInstruction = null;

                    loader
                        .add("images/grid.png")
                        .add("images/grid_win_temp.png")
                        .add("images/check.png")
                        .add("images/grid_6x10_normal.png")
                        .add("images/grid_5x12_normal.png")
                        .add("images/grid_4x15_normal.png")
                        .add("images/grid_3x20_normal.png")
                        .add("images/blockz.png")
                        .add("images/blocky.png")
                        .add("images/blockl.png")
                        .add("images/blocki.png")
                        .add("images/blockn.png")
                        .add("images/blockt.png")
                        .add("images/blockx.png")
                        .add("images/blockw.png")
                        .add("images/blockf.png")
                        .add("images/blockv.png")
                        .add("images/blocku.png")
                        .add("images/blockp.png")
                        .add("images/button_info_on.png")
                        .add("images/button_info_off.png")
                        .add("images/instruction.png")
                        .add("images/about.png")
                        .add("images/howtouse.png")
                        .add("images/logo_pentamino.png")
                        .add("images/reset.png")
                        .add("images/close.png")
                        .add('desyrel', 'required/assets/desyrel.xml')
                        .load(setupMiniGrids)
                        .load(setupGrid)
                        .load(setupLetterZ)
                        .load(setupLetterY)
                        .load(setupLetterL)
                        .load(setupLetterI)
                        .load(setupLetterN)
                        .load(setupLetterT)
                        .load(setupLetterX)
                        .load(setupLetterW)
                        .load(setupLetterF)
                        .load(setupLetterV)
                        .load(setupLetterU)
                        .load(setupLetterP)
                        .load(setupMenuOption)
                        .load(drawLogoPentamino);

                    function setupMiniGrids() {

                        //Create the grid
                        miniGridContainer = new Container();
                        miniGridContainer.filter = { name: "miniGridContainer" };
                        resource = resources["images/grid_6x10_normal.png"].texture;
                        grid6x10 = new Sprite(resource);
                        grid6x10.interactive = true;
                        grid6x10.buttonMode = true;
                        grid6x10.x = MINI_GRID_INDENDATION;
                        grid6x10.y = GRID_INDENTATION_Y;
                        grid6x10.filter = { name: "grid6x10", row : 6 , column : 10, status : "not_winner", selected: true };
                        miniGridContainer.addChild(grid6x10);
                        grid6x10.on('click', onClickMiniGrid)
                            .on('tap',onClickMiniGrid);
                        drawBackgroundRectMiniGrid(grid6x10.x, grid6x10.y, grid6x10.width, grid6x10.height);

                        resource = resources["images/grid_5x12_normal.png"].texture;
                        grid5X12 = new Sprite(resource);
                        grid5X12.interactive = true;
                        grid5X12.buttonMode = true;
                        grid5X12.x = MINI_GRID_INDENDATION;
                        grid5X12.y = grid6x10.y + grid6x10.height + defaultIndentation;
                        grid5X12.filter = { name: "grid5X12", row : 5 , column : 12, status : "not_winner", selected: false };
                        miniGridContainer.addChild(grid5X12);
                        grid5X12.on('click', onClickMiniGrid)
                            .on('tap',onClickMiniGrid);

                        resource = resources["images/grid_4x15_normal.png"].texture;
                        grid4x15 = new Sprite(resource);
                        grid4x15.interactive = true;
                        grid4x15.buttonMode = true;
                        grid4x15.x = MINI_GRID_INDENDATION;
                        grid4x15.y = grid5X12.y + grid5X12.height + defaultIndentation;
                        grid4x15.filter = { name: "grid4x15", row : 4 , column : 15, status : "not_winner", selected: false };
                        miniGridContainer.addChild(grid4x15);
                        grid4x15.on('click', onClickMiniGrid)
                            .on('tap',onClickMiniGrid);

                        resource = resources["images/grid_3x20_normal.png"].texture;
                        grid3x20 = new Sprite(resource);
                        grid3x20.interactive = true;
                        grid3x20.buttonMode = true;
                        grid3x20.x = MINI_GRID_INDENDATION;
                        grid3x20.y = grid4x15.y + grid4x15.height + defaultIndentation;
                        grid3x20.filter = { name: "grid3x20", row : 3 , column : 20, status : "not_winner", selected: false };
                        miniGridContainer.addChild(grid3x20);
                        grid3x20.on('click', onClickMiniGrid)
                            .on('tap',onClickMiniGrid);

                        stage.addChild(miniGridContainer);

                        // seta o primeiro GRID como padr√£o ao iniciar o game
                        currentGrid = miniGridContainer.children[0];

                    }

                    function drawLogoPentamino(){
                        //add logo
                        logoPentamino = new Container();
                        logoPentamino.x = MINI_GRID_INDENDATION;
                        logoPentamino.y = MINI_GRID_INDENDATION;
                        // logo.buttonMode = true;

                        resource = resources["images/logo_pentamino.png"].texture;
                        var button = new Sprite(resource);
                        logoPentamino.addChild(button);
                        button.position.y = 0;
                        button.position.x = 0;
                        button.width = 200;
                        button.height = 45;

                        stage.addChild(logoPentamino);
                        logoPentamino.updateTransform();
                    }

                    function setupMenuOption(){

                        //add button reset
                            buttonReset = new Container();
                            buttonReset.interactive = true;
                            buttonReset.x = GRID_WIDTH - 150;
                            buttonReset.y = MINI_GRID_INDENDATION;
                            buttonReset.zIndex = 0;
                            buttonReset.filter = { click: false };
                            buttonReset.buttonMode = true;

                            resource = resources["images/reset.png"].texture;
                            var btnReset = new Sprite(resource);
                            buttonReset.addChild(btnReset);
                            btnReset.position.y = 0;
                            btnReset.position.x = 0;
                            buttonReset.on("click", resetGameGridSelected).on("tap", resetGameGridSelected);

                            stage.addChild(buttonReset);
                            buttonReset.updateTransform();                       

                        //add button info
                            buttonInfo = new Container();
                            buttonInfo.interactive = true;
                            buttonInfo.x = GRID_WIDTH - 40;
                            buttonInfo.y = MINI_GRID_INDENDATION;
                            buttonInfo.zIndex = 0;
                            buttonInfo.filter = { click: false };
                            buttonInfo.buttonMode = true;

                            resource = resources["images/button_info_off.png"].texture;
                            var button = new Sprite(resource);
                            buttonInfo.addChild(button);
                            button.position.y = 0;
                            button.position.x = 0;

                            buttonInfo.click = buttonInfo.tap = function(event){
                                if(buttonInfo.filter.click){
                                    enableLetters();
                                    closeMenuOption();
                                }
                                else{
                                    showBackgroundModal();
                                    showModalInstruction();
                                    buttonInfo.filter.click = true;
                                    buttonInfo.children[0].texture = PIXI.Texture.fromImage('images/button_info_on.png');
                                }
                                
                            };

                            stage.addChild(buttonInfo);
                            buttonInfo.updateTransform();

                        
                    }

                    function showBackgroundModal(){
                        stage.removeChild(rectModalBackground);
                        rectModalBackground = new PIXI.Graphics();
                        rectModalBackground.beginFill(0xA9A9A9);
                        // rectModalBackground.alpha = 0.8;
                        // draw a rectangle
                        rectModalBackground.drawRect(0, 0, 1000,700);
                        rectModalBackground.endFill();
                        
                        stage.addChild(rectModalBackground);
                    }

                    function showModalInstruction(){
                        disableLetters();
                        stage.removeChild(rectModalInstruction);
                        rectModalInstruction = new PIXI.Graphics();
                        rectModalInstruction.beginFill(0xFFFFFF);
                        // draw a rectangle
                        rectModalInstruction.drawRoundedRect(100, 100, 800, 500, 20);
                        rectModalInstruction.endFill();

                        rectModalInstruction.interactive = true;
                        
                        resource = resources["images/close.png"].texture;
                        var buttonClose = new Sprite(resource);
                        rectModalInstruction.addChild(buttonClose);
                        buttonClose.interactive = true;
                        buttonClose.position.y = 130;
                        buttonClose.position.x = 850;
                        buttonClose.buttonMode = true;
                        buttonClose.width = 20;
                        buttonClose.height = 20;
                        buttonClose.click = buttonClose.tap = function(event){
                            enableLetters();
                            closeMenuOption();
                        };
                        rectModalInstruction.addChild(buttonClose);

                        var titleModal = new PIXI.Text('Instru√ß√µes', {
                            fontWeight: 'bold',
                            fontStyle: 'normal',
                            fontSize: 25,
                            // fontFamily: 'Exo+2',
                            fill: '#2F4F4F', 
                            align: 'left'
                            // ,
                            // stroke: '#a4410e',
                            // strokeThickness: 7
                        });
                        titleModal.x = 150;
                        titleModal.y = 130;
                        rectModalInstruction.addChild(titleModal);

                        var text = "Para jogar, escolha uma das op√ß√µes de tabuleiro indicadas √° esquerda.\n"+
                                    "Depois, selecione a pe√ßa desejada e arraste-a para cima do tabuleiro.\n"+
                                    "Ele mudar√° de cor. Nessa situa√ß√£o, ela pode ser girada - utilizando-se as\n"+
                                    "setas direcionadas do teclado ou dando um duplo clique nela - ou espelhada\n"+
                                    "pressionando-se a tecla de espa√ßo.\n\n"+
                                    "Quando a pe√ßa for colocada sobre um espa√ßo onde pode ser encaixada,\n"+
                                    "ficar√° verde.";

                        var bodytModal = new PIXI.Text(text, {
                            // fontWeight: 'bold',
                            // fontStyle: 'normal',
                            fontSize: 21,
                            // fontFamily: 'Exo+2',
                            fill: '#808080', 
                            // align: 'left'
                            // ,
                            // stroke: '#a4410e',
                            // strokeThickness: 7
                        });
                        bodytModal.x = 150;
                        bodytModal.y = 180;
                        rectModalInstruction.addChild(bodytModal);

                        rectModalInstruction.on('mousedown', touchModalStart)
                            .on('touchstart', touchModalStart)
                            .on('mouseup', touchModalEnd)
                            .on('mouseupoutside', touchModalEnd)
                            .on('touchend', touchModalEnd)
                            .on('touchendoutside', touchModalEnd)
                            .on('mousemove', touchModalMove)
                            .on('touchmove', touchModalMove);
                        rectModalInstruction.displayGroup = letterLayer;
                        stage.addChild(rectModalInstruction);
                    }

                    function closeMenuOption(){
                        if(rectModalInstruction != null){
                            rectModalInstruction.interactive = false;
                            buttonInfo.filter.click = false;
                            buttonInfo.children[0].texture = PIXI.Texture.fromImage('images/button_info_off.png');
                            stage.removeChild(rectModalInstruction);
                            stage.removeChild(rectModalBackground);
                        }
                    }

                    function touchModalStart(event){
                        this.start_data = { x: event.data.originalEvent.screenX, y: event.data.originalEvent.screenY };
                        this.data = event.data;
                        this.dragging = true;
                    }

                    function touchModalEnd(event){
                        var ev_data = event.data.originalEvent;
                        this.alpha = 1;
                        this.dragging = false;

                        if (this.start_data) {
                            if (Math.abs(this.start_data.x - ev_data.screenX) > 2 || Math.abs(this.start_data.y - ev_data.screenY) > 2) {
                                event.stopPropagation();
                            }
                        }
                    }

                    function touchModalMove(event){
                        if (this.dragging)
                        {
                            this.position.y += this.data.originalEvent.movementY;
                            event.currentTarget.calculateBounds();
                            var bounds = event.currentTarget._bounds;

                            //Top
                            if (bounds.maxY < 600) {
                                this.y = this.position.y + 10;
                            }

                            //Bottom
                            if (bounds.minY > 200) {
                                this.y = 50;
                            }
                        }
                    }

                    function disableLetters(){
                        var letters = stage.children;

                        for(var i=0; i < letters.length; i++){
                            if(letters[i].filter != undefined){
                                if(letters[i].filter.name != undefined){
                                    stage.children[i].visible = false;
                                    stage.children[i].interactive = false;
                                }
                            }
                        }
                    }

                    function enableLetters(){
                        var letters = stage.children;

                        for(var i=0; i < letters.length; i++){
                            if(letters[i].filter != undefined){
                                if(letters[i].filter.name != undefined){
                                    stage.children[i].visible = true;
                                    stage.children[i].interactive = true;
                                }
                            }
                        }
                    }

                    function setupGrid() {

                        //Create the grid
                        gridContainer = new Container();
                        resource = resources["images/grid.png"].texture;
                        var grid = new Sprite(resource);
                        gridContainer.addChild(grid);
                        stage.addChild(gridContainer);

                        gridContainer.x = GRID_INDENTATION;
                        gridContainer.y = GRID_INDENTATION_Y;

                        drawAllRectGridBackground();
                        gridHeight = grid.height + defaultIndentation;
                        drawBackgroundRectForLetters(gridHeight);
                    }

                    function drawAllRectGridBackground() {

                        var row = rowSelected, column = columnSelected;
                        matrixGrid = new Array();
                        for(var y = 1; y <= row; y++) {
                            for(var x = 1; x <= column; x++) {
                                var maxX = 0, minX = 0, maxY = 0, minY = 0;
                                maxX = ((DEFAULT_SIZE_BLOCK * x) - (x * minPixel)) + (GRID_INDENTATION + minPixel);
                                maxY = ((DEFAULT_SIZE_BLOCK * y) - (y * minPixel)) + (GRID_INDENTATION_Y + minPixel);
                                minX = ((maxX - DEFAULT_SIZE_BLOCK) + minPixel)
                                minY = ((maxY - DEFAULT_SIZE_BLOCK) + minPixel)

                                matrixGrid.push(
                                    { 
                                        minX: minX, 
                                        minY: minY, 
                                        maxX: maxX, 
                                        maxY: maxY,
                                        centerX: minX + defaultIndentation, 
                                        centerY: minY + defaultIndentation, 
                                        check: false, 
                                        idLetters: 0 
                                    });
                            }
                        }

                        var bgWidth = DEFAULT_SIZE_BLOCK * column - (minPixel * (column - 1));
                        var bgHeight = DEFAULT_SIZE_BLOCK * row - (minPixel * (row - 1));

                        countCheckGrid();
                        drawBackgroundRectGrid(bgWidth,bgHeight );
                    }

                    function drawBackgroundRectGrid(bgWidth,bgHeight) {
                        stage.removeChild(rectGridGraphics);
                        rectGridGraphics = new PIXI.Graphics();
                        rectGridGraphics.beginFill(0xFDFDFF);
                        rectGridGraphics.alpha = 0.1;
                        // draw a rectangle
                        rectGridGraphics.drawRect(GRID_INDENTATION, GRID_INDENTATION_Y, bgWidth,bgHeight);
                        rectGridGraphics.endFill();

                        stage.addChild(rectGridGraphics);
                    }

                    function drawBackgroundRectMiniGrid(x, y, bgWidth,bgHeight) {
                        stage.removeChild(rectMiniGridGraphics);
                        rectMiniGridGraphics = new PIXI.Graphics();
                        rectMiniGridGraphics.beginFill(0x5F9E5D);
                        rectMiniGridGraphics.alpha = 0.4;
                        // draw a rectangle
                        rectMiniGridGraphics.drawRect(x, y, bgWidth,bgHeight);
                        rectMiniGridGraphics.endFill();

                        stage.addChild(rectMiniGridGraphics);
                    }

                    function drawBackgroundRectForLetters(gridHeight) {
                        var graphics = new PIXI.Graphics();

                        graphics.beginFill(0xBCB09A);

                        // draw a rectangle
                        graphics.drawRect(MINI_GRID_INDENDATION, gridHeight, GRID_WIDTH, GRID_HEIGHT);
                        graphics.y = GRID_INDENTATION_Y;

                        stage.addChild(graphics);
                    }

                    function setupLetterZ() {

                        //Create the sprites
                        gameSceneZ = new Container();
                        gameSceneZ.interactive = true;
                        gameSceneZ.position.rotation = 0;
                        gameSceneZ.x = MINI_GRID_INDENDATION + defaultIndentation * 4;
                        gameSceneZ.y = gridHeight + GRID_INDENTATION_Y + defaultIndentation * 4;
                        gameSceneZ.filter = { name: "Z", id: 1, x: gameSceneZ.x, y: gameSceneZ.y, statusPosition: 0 };
                        gameSceneZ.rotation = 0;
                        gameSceneZ.zIndex = 0;

                        resource = resources["images/blockz.png"].texture;
                        var block1 = new Sprite(resource);
                        var block2 = new Sprite(resource);
                        var block3 = new Sprite(resource);
                        var block4 = new Sprite(resource);
                        var block5 = new Sprite(resource);

                        gameSceneZ.addChild(block1);
                        block1.position.y = 0;
                        block1.position.x = 0;

                        gameSceneZ.addChild(block2);
                        block2.position.y = block1.height - minPixel;
                        block2.position.x = 0;

                        gameSceneZ.addChild(block3);
                        block3.position.y = block1.height - minPixel;
                        block3.position.x = block1.width - minPixel;

                        gameSceneZ.addChild(block4);
                        block4.position.y = block1.height - minPixel;
                        block4.position.x = block1.width + block2.width - (minPixel * 2 );

                        gameSceneZ.addChild(block5);
                        block5.position.y = block1.height + block2.height - (minPixel * 2 );
                        block5.position.x = block1.width + block2.width - (minPixel * 2 );

                        gameSceneZ.on('mousedown', onDragStart)
                            .on('touchstart', onDragStart)
                            .on('mouseup', onDragEnd)
                            .on('mouseupoutside', onDragEnd)
                            .on('touchend', onDragEnd)
                            .on('touchendoutside', onDragEnd)
                            .on('mousemove', onDragMove)
                            .on('touchmove', onDragMove)
                            .on('tap', onClick)
                            .on('click', onClick);

                        gameSceneZ.displayGroup = letterLayer;
                        stage.addChild(gameSceneZ);
                        gameSceneZ.pivot.set(gameSceneZ.width/2, gameSceneZ.height/2);
                        gameSceneZ.updateTransform();
                    }

                    function setupLetterY() {

                        //Create the sprites
                        gameSceneY = new Container();
                        gameSceneY.interactive = true;
                        gameSceneY.position.rotation = 0;
                        gameSceneY.x = MINI_GRID_INDENDATION + defaultIndentation * 5;
                        gameSceneY.y = gridHeight + GRID_INDENTATION_Y + defaultIndentation * 9;
                        gameSceneY.filter = { name: "Y", id: 2, x: gameSceneY.x, y: gameSceneY.y, statusPosition: 0 };
                        gameSceneY.rotation = 0;
                        gameSceneY.zIndex = 0;

                        resource = resources["images/blocky.png"].texture;
                        var block1 = new Sprite(resource);
                        var block2 = new Sprite(resource);
                        var block3 = new Sprite(resource);
                        var block4 = new Sprite(resource);
                        var block5 = new Sprite(resource);

                        gameSceneY.addChild(block1);
                        block1.position.y = block1.height - minPixel;
                        block1.position.x = 0;

                        gameSceneY.addChild(block2);
                        block2.position.y = block1.height - minPixel;
                        block2.position.x = block1.width - minPixel;

                        gameSceneY.addChild(block3);
                        block3.position.y = 0;
                        block3.position.x = block1.width - minPixel;

                        gameSceneY.addChild(block4);
                        block4.position.y = block1.height - minPixel;
                        block4.position.x = block1.width + block2.width - (minPixel * 2);

                        gameSceneY.addChild(block5);
                        block5.position.y = block1.height - minPixel;
                        block5.position.x = block1.width + block2.width + block3.width - (minPixel * 3);

                        gameSceneY.on('mousedown', onDragStart)
                            .on('touchstart', onDragStart)
                            .on('mouseup', onDragEnd)
                            .on('mouseupoutside', onDragEnd)
                            .on('touchend', onDragEnd)
                            .on('touchendoutside', onDragEnd)
                            .on('mousemove', onDragMove)
                            .on('touchmove', onDragMove)
                            .on('tap', onClick)
                            .on('click', onClick);
                        
                        gameSceneY.displayGroup = letterLayer;
                        stage.addChild(gameSceneY);
                        gameSceneY.pivot.set(gameSceneY.width/2, gameSceneY.height/2);
                        gameSceneY.updateTransform();
                    }

                    function setupLetterL() {

                        //Create the sprites
                        gameSceneL = new Container();
                        gameSceneL.interactive = true;
                        gameSceneL.position.rotation = 0;
                        gameSceneL.x = MINI_GRID_INDENDATION + defaultIndentation * 10;
                        gameSceneL.y = gridHeight + GRID_INDENTATION_Y + defaultIndentation * 5;
                        gameSceneL.filter = { name: "L", id: 3, x: gameSceneL.x, y: gameSceneL.y, statusPosition: 0 };
                        gameSceneL.rotation = 0;
                        gameSceneL.zIndex = 0;

                        resource = resources["images/blockl.png"].texture;
                        var block1 = new Sprite(resource);
                        var block2 = new Sprite(resource);
                        var block3 = new Sprite(resource);
                        var block4 = new Sprite(resource);
                        var block5 = new Sprite(resource);

                        gameSceneL.addChild(block1);
                        block1.position.y = 0;
                        block1.position.x = 0;

                        gameSceneL.addChild(block2);
                        block2.position.y = 0;
                        block2.position.x = block1.width - minPixel;

                        gameSceneL.addChild(block3);
                        block3.position.y = block1.height - minPixel;
                        block3.position.x = block1.width - minPixel;

                        gameSceneL.addChild(block4);
                        block4.position.y = block1.height + block2.height - (minPixel * 2);
                        block4.position.x = block1.width - minPixel;

                        gameSceneL.addChild(block5);
                        block5.position.y = block1.height + block2.height + block3.height - (minPixel * 3);
                        block5.position.x = block1.width - minPixel;

                        gameSceneL.on('mousedown', onDragStart)
                            .on('touchstart', onDragStart)
                            .on('mouseup', onDragEnd)
                            .on('mouseupoutside', onDragEnd)
                            .on('touchend', onDragEnd)
                            .on('touchendoutside', onDragEnd)
                            .on('mousemove', onDragMove)
                            .on('touchmove', onDragMove)
                            .on('tap', onClick)
                            .on('click', onClick);

                        gameSceneL.displayGroup = letterLayer;
                        stage.addChild(gameSceneL);
                        gameSceneL.pivot.set(gameSceneL.width/2, gameSceneL.height/2);
                        gameSceneL.updateTransform();
                    }
                    
                    function setupLetterI() {

                        //Create the sprites
                        gameSceneI = new Container();
                        gameSceneI.interactive = true;
                        gameSceneI.position.rotation = 0;
                        gameSceneI.x = MINI_GRID_INDENDATION + defaultIndentation * 18;
                        gameSceneI.y = gridHeight + GRID_INDENTATION_Y + defaultIndentation * 2 + 5;
                        gameSceneI.filter = { name: "I", id: 4, x: gameSceneI.x, y: gameSceneI.y, statusPosition: 0 };
                        gameSceneI.rotation = 0;
                        gameSceneI.zIndex = 0;
                        
                        resource = resources["images/blocki.png"].texture;
                        var block1 = new Sprite(resource);
                        var block2 = new Sprite(resource);
                        var block3 = new Sprite(resource);
                        var block4 = new Sprite(resource);
                        var block5 = new Sprite(resource);

                        gameSceneI.addChild(block1);
                        block1.position.y = 0;
                        block1.position.x = 0;

                        gameSceneI.addChild(block2);
                        block2.position.y = 0;
                        block2.position.x = block1.width - minPixel;

                        gameSceneI.addChild(block3);
                        block3.position.y = 0;
                        block3.position.x = block1.width + block2.width - (minPixel * 2);

                        gameSceneI.addChild(block4);
                        block4.position.y = 0;
                        block4.position.x = block1.width + block2.width + block3.width - (minPixel * 3);

                        gameSceneI.addChild(block5);
                        block5.position.y = 0;
                        block5.position.x = block1.width + block2.width + block3.width + block4.width - (minPixel * 4);

                        gameSceneI.on('mousedown', onDragStart)
                            .on('touchstart', onDragStart)
                            .on('mouseup', onDragEnd)
                            .on('mouseupoutside', onDragEnd)
                            .on('touchend', onDragEnd)
                            .on('touchendoutside', onDragEnd)
                            .on('mousemove', onDragMove)
                            .on('touchmove', onDragMove)
                            .on('tap', onClick)
                            .on('click', onClick);

                        gameSceneI.displayGroup = letterLayer;
                        stage.addChild(gameSceneI);
                        gameSceneI.pivot.set(gameSceneI.width/2, gameSceneI.height/2);
                        gameSceneI.updateTransform();
                    }

                    function setupLetterN() {

                        //Create the sprites
                        gameSceneN = new Container();
                        gameSceneN.interactive = true;
                        gameSceneN.position.rotation = 0;
                        gameSceneN.x = MINI_GRID_INDENDATION + defaultIndentation * 14 + 5;
                        gameSceneN.y = gridHeight + GRID_INDENTATION_Y + defaultIndentation * 7 + 10;
                        gameSceneN.filter = { name: "N", id: 5, x: gameSceneN.x, y: gameSceneN.y, statusPosition: 0 };
                        gameSceneN.rotation = 0;
                        gameSceneN.zIndex = 0;

                        resource = resources["images/blockn.png"].texture;
                        var block1 = new Sprite(resource);
                        var block2 = new Sprite(resource);
                        var block3 = new Sprite(resource);
                        var block4 = new Sprite(resource);
                        var block5 = new Sprite(resource);

                        gameSceneN.addChild(block1);
                        block1.position.y = 0;
                        block1.position.x = block1.width - minPixel;

                        gameSceneN.addChild(block2);
                        block2.position.y = block1.height - minPixel;
                        block2.position.x = block1.width - minPixel;

                        gameSceneN.addChild(block3);
                        block3.position.y = block1.height + block2.height - (minPixel * 2);
                        block3.position.x = block1.width - minPixel;

                        gameSceneN.addChild(block4);
                        block4.position.y = block1.height + block2.height - (minPixel * 2);
                        block4.position.x = 0;

                        gameSceneN.addChild(block5);
                        block5.position.y = block1.height + block2.height + block3.height - (minPixel * 3);
                        block5.position.x = 0;

                        gameSceneN.on('mousedown', onDragStart)
                            .on('touchstart', onDragStart)
                            .on('mouseup', onDragEnd)
                            .on('mouseupoutside', onDragEnd)
                            .on('touchend', onDragEnd)
                            .on('touchendoutside', onDragEnd)
                            .on('mousemove', onDragMove)
                            .on('touchmove', onDragMove)
                            .on('tap', onClick)
                            .on('click', onClick);

                        gameSceneN.displayGroup = letterLayer;
                        stage.addChild(gameSceneN);
                        gameSceneN.pivot.set(gameSceneN.width/2, gameSceneN.height/2);
                        gameSceneN.updateTransform();
                    }
                    
                    function setupLetterT() {

                        //Create the sprites
                        gameSceneT = new Container();
                        gameSceneT.interactive = true;
                        gameSceneT.position.rotation = 0;
                        gameSceneT.x = MINI_GRID_INDENDATION + defaultIndentation * 20;
                        gameSceneT.y = gridHeight + GRID_INDENTATION_Y + defaultIndentation * 8;
                        gameSceneT.filter = { name: "T", id: 6, x: gameSceneT.x, y: gameSceneT.y, statusPosition: 0 };
                        gameSceneT.rotation = 0;
                        gameSceneT.zIndex = 0;

                        resource = resources["images/blockt.png"].texture;
                        var block1 = new Sprite(resource);
                        var block2 = new Sprite(resource);
                        var block3 = new Sprite(resource);
                        var block4 = new Sprite(resource);
                        var block5 = new Sprite(resource);

                        gameSceneT.addChild(block1);
                        block1.position.y = 0;
                        block1.position.x = block1.height - minPixel;

                        gameSceneT.addChild(block2);
                        block2.position.y = block1.height - minPixel;
                        block2.position.x = block1.width - minPixel;

                        gameSceneT.addChild(block3);
                        block3.position.y = (block1.height - minPixel) + (block2.height - minPixel);
                        block3.position.x = (block1.width - minPixel) + (block2.width - minPixel);

                        gameSceneT.addChild(block4);
                        block4.position.y = (block1.height - minPixel) + (block2.height - minPixel);
                        block4.position.x = (block1.height - minPixel);

                        gameSceneT.addChild(block5);
                        block5.position.y = (block1.height - minPixel) + (block1.height - minPixel);
                        block5.position.x = 0;

                        gameSceneT.on('mousedown', onDragStart)
                            .on('touchstart', onDragStart)
                            .on('mouseup', onDragEnd)
                            .on('mouseupoutside', onDragEnd)
                            .on('touchend', onDragEnd)
                            .on('touchendoutside', onDragEnd)
                            .on('mousemove', onDragMove)
                            .on('touchmove', onDragMove)
                            .on('tap', onClick)
                            .on('click', onClick);

                        gameSceneT.displayGroup = letterLayer;
                        stage.addChild(gameSceneT);
                        gameSceneT.pivot.set(gameSceneT.width/2, gameSceneT.height/2);
                        gameSceneT.updateTransform();
                    }

                    function setupLetterX() {

                        //Create the sprites
                        gameSceneX = new Container();
                        gameSceneX.interactive = true;
                        gameSceneX.position.rotation = 0;
                        gameSceneX.x = MINI_GRID_INDENDATION + defaultIndentation * 26;
                        gameSceneX.y = gridHeight + GRID_INDENTATION_Y + defaultIndentation * 9;
                        gameSceneX.filter = { name: "X", id: 7, x: gameSceneX.x, y: gameSceneX.y, statusPosition: 0 };
                        gameSceneX.rotation = 0;
                        gameSceneX.zIndex = 0;

                        resource = resources["images/blockx.png"].texture;
                        var block1 = new Sprite(resource);
                        var block2 = new Sprite(resource);
                        var block3 = new Sprite(resource);
                        var block4 = new Sprite(resource);
                        var block5 = new Sprite(resource);

                        gameSceneX.addChild(block1);
                        block1.position.y = 0;
                        block1.position.x = block1.width - minPixel;

                        gameSceneX.addChild(block2);
                        block2.position.y = block1.height - minPixel;
                        block2.position.x = 0;

                        gameSceneX.addChild(block3);
                        block3.position.y = block1.height - minPixel;
                        block3.position.x = block1.width - minPixel;

                        gameSceneX.addChild(block4);
                        block4.position.y = block1.height - minPixel;
                        block4.position.x = block1.width + block2.width - (minPixel * 2);

                        gameSceneX.addChild(block5);
                        block5.position.y = block1.height + block2.height - (minPixel * 2);
                        block5.position.x = block1.width - minPixel;

                        gameSceneX.on('mousedown', onDragStart)
                            .on('touchstart', onDragStart)
                            .on('mouseup', onDragEnd)
                            .on('mouseupoutside', onDragEnd)
                            .on('touchend', onDragEnd)
                            .on('touchendoutside', onDragEnd)
                            .on('mousemove', onDragMove)
                            .on('touchmove', onDragMove);

                        gameSceneX.displayGroup = letterLayer;
                        stage.addChild(gameSceneX);
                        gameSceneX.pivot.set(gameSceneX.width/2, gameSceneX.height/2);
                        gameSceneX.updateTransform();
                    }

                    function setupLetterW() {

                        //Create the sprites
                        gameSceneW = new Container();
                        gameSceneW.interactive = true;
                        gameSceneW.position.rotation = 0;
                        gameSceneW.x = MINI_GRID_INDENDATION + defaultIndentation * 27;
                        gameSceneW.y = gridHeight + GRID_INDENTATION_Y + defaultIndentation * 4;
                        gameSceneW.filter = { name: "W", id: 8, x: gameSceneW.x, y: gameSceneW.y, statusPosition: 0 };
                        gameSceneW.rotation = 0;
                        gameSceneW.zIndex = 0;
                        
                        resource = resources["images/blockw.png"].texture;
                        var block1 = new Sprite(resource);
                        var block2 = new Sprite(resource);
                        var block3 = new Sprite(resource);
                        var block4 = new Sprite(resource);
                        var block5 = new Sprite(resource);

                        gameSceneW.addChild(block1);
                        block1.position.y = 0;
                        block1.position.x = 0;

                        gameSceneW.addChild(block2);
                        block2.position.y = 0;
                        block2.position.x = block1.width - minPixel;

                        gameSceneW.addChild(block3);
                        block3.position.y = block1.height - minPixel;
                        block3.position.x = block1.width - minPixel;

                        gameSceneW.addChild(block4);
                        block4.position.y = block1.height - minPixel;
                        block4.position.x = block1.width + block2.width - (minPixel * 2);

                        gameSceneW.addChild(block5);
                        block5.position.y = block1.height + block2.height - (minPixel * 2);
                        block5.position.x = block1.width + block2.width - (minPixel * 2);

                        gameSceneW.on('mousedown', onDragStart)
                            .on('touchstart', onDragStart)
                            .on('mouseup', onDragEnd)
                            .on('mouseupoutside', onDragEnd)
                            .on('touchend', onDragEnd)
                            .on('touchendoutside', onDragEnd)
                            .on('mousemove', onDragMove)
                            .on('touchmove', onDragMove)
                            .on('tap', onClick)
                            .on('click', onClick);

                        gameSceneW.displayGroup = letterLayer;
                        stage.addChild(gameSceneW);
                        gameSceneW.pivot.set(gameSceneW.width/2, gameSceneW.height/2);
                        gameSceneW.updateTransform();
                    }
                    
                    function setupLetterF() {

                        //Create the sprites
                        gameSceneF = new Container();
                        gameSceneF.interactive = true;
                        gameSceneF.position.rotation = 0;
                        gameSceneF.x = MINI_GRID_INDENDATION + defaultIndentation * 33;
                        gameSceneF.y = gridHeight + GRID_INDENTATION_Y + defaultIndentation * 4;
                        gameSceneF.filter = { name: "F", id: 9, x: gameSceneF.x, y: gameSceneF.y, statusPosition: 0 };
                        gameSceneF.rotation = 0;
                        gameSceneF.zIndex = 0;

                        resource = resources["images/blockf.png"].texture;
                        var block1 = new Sprite(resource);
                        var block2 = new Sprite(resource);
                        var block3 = new Sprite(resource);
                        var block4 = new Sprite(resource);
                        var block5 = new Sprite(resource);

                        gameSceneF.addChild(block1);
                        block1.position.y = block1.height - minPixel;
                        block1.position.x = 0;

                        gameSceneF.addChild(block2);
                        block2.position.y = block1.height - minPixel;
                        block2.position.x = block1.width - minPixel;

                        gameSceneF.addChild(block3);
                        block3.position.y = 0;
                        block3.position.x = block1.width - minPixel;

                        gameSceneF.addChild(block4);
                        block4.position.y = block1.height - minPixel;
                        block4.position.x = block1.width + block2.width - (minPixel * 2);

                        gameSceneF.addChild(block5);
                        block5.position.y = block1.height + block2.height - (minPixel * 2);
                        block5.position.x = block1.width + block2.width - (minPixel * 2);

                        gameSceneF.on('mousedown', onDragStart)
                            .on('touchstart', onDragStart)
                            .on('mouseup', onDragEnd)
                            .on('mouseupoutside', onDragEnd)
                            .on('touchend', onDragEnd)
                            .on('touchendoutside', onDragEnd)
                            .on('mousemove', onDragMove)
                            .on('touchmove', onDragMove)
                            .on('tap', onClick)
                            .on('click', onClick);

                        gameSceneF.displayGroup = letterLayer;
                        gameSceneF.pivot.set(gameSceneF.width/2, gameSceneF.height/2);
                        stage.addChild(gameSceneF);
                        gameSceneF.updateTransform();
                    }

                    function setupLetterV() {

                        //Create the sprites
                        gameSceneV = new Container();
                        gameSceneV.interactive = true;
                        gameSceneV.position.rotation = 0;
                        gameSceneV.x = MINI_GRID_INDENDATION + defaultIndentation * 33;
                        gameSceneV.y = gridHeight + GRID_INDENTATION_Y + defaultIndentation * 10;
                        gameSceneV.filter = { name: "V", id: 10, x: gameSceneV.x, y: gameSceneV.y, statusPosition: 0 };
                        gameSceneV.rotation = 0;
                        gameSceneV.zIndex = 0;

                        resource = resources["images/blockv.png"].texture;
                        var block1 = new Sprite(resource);
                        var block2 = new Sprite(resource);
                        var block3 = new Sprite(resource);
                        var block4 = new Sprite(resource);
                        var block5 = new Sprite(resource);

                        gameSceneV.addChild(block1);
                        block1.position.y = 0;
                        block1.position.x = 0;

                        gameSceneV.addChild(block2);
                        block2.position.y = block1.height - minPixel;
                        block2.position.x = 0 ;

                        gameSceneV.addChild(block3);
                        block3.position.y = block1.height + block2.height - (minPixel * 2);
                        block3.position.x = 0;

                        gameSceneV.addChild(block4);
                        block4.position.y = 0;
                        block4.position.x = block1.width - minPixel;

                        gameSceneV.addChild(block5);
                        block5.position.y = 0;
                        block5.position.x = block1.width + block2.width - (minPixel * 2);

                        gameSceneV.on('mousedown', onDragStart)
                            .on('touchstart', onDragStart)
                            .on('mouseup', onDragEnd)
                            .on('mouseupoutside', onDragEnd)
                            .on('touchend', onDragEnd)
                            .on('touchendoutside', onDragEnd)
                            .on('mousemove', onDragMove)
                            .on('touchmove', onDragMove)
                            .on('tap', onClick)
                            .on('click', onClick);

                        gameSceneV.displayGroup = letterLayer;
                        stage.addChild(gameSceneV);
                        gameSceneV.pivot.set(gameSceneV.width/2, gameSceneV.height/2);
                        gameSceneV.updateTransform();
                    }

                    function setupLetterU() {

                        //Create the sprites
                        gameSceneU = new Container();
                        gameSceneU.interactive = true;
                        gameSceneU.position.rotation = 0;
                        gameSceneU.x = MINI_GRID_INDENDATION + defaultIndentation * 39;
                        gameSceneU.y = gridHeight + GRID_INDENTATION_Y + defaultIndentation * 3;
                        gameSceneU.filter = { name: "U", id: 11, x: gameSceneU.x, y: gameSceneU.y, statusPosition: 0 };
                        gameSceneU.rotation = 0;
                        gameSceneU.zIndex = 0;

                        resource = resources["images/blocku.png"].texture;
                        var block1 = new Sprite(resource);
                        var block2 = new Sprite(resource);
                        var block3 = new Sprite(resource);
                        var block4 = new Sprite(resource);
                        var block5 = new Sprite(resource);

                        gameSceneU.addChild(block1);
                        block1.position.y = 0;
                        block1.position.x = 0;

                        gameSceneU.addChild(block2);
                        block2.position.y = block1.height - minPixel;
                        block2.position.x = 0 ;

                        gameSceneU.addChild(block3);
                        block3.position.y = block1.height - minPixel;
                        block3.position.x = block1.width - minPixel;

                        gameSceneU.addChild(block4);
                        block4.position.y = block1.height - minPixel;
                        block4.position.x = block1.width + block2.width - (minPixel * 2);

                        gameSceneU.addChild(block5);
                        block5.position.y = 0;
                        block5.position.x = block1.width + block2.width - (minPixel * 2);

                        gameSceneU.on('mousedown', onDragStart)
                            .on('touchstart', onDragStart)
                            .on('mouseup', onDragEnd)
                            .on('mouseupoutside', onDragEnd)
                            .on('touchend', onDragEnd)
                            .on('touchendoutside', onDragEnd)
                            .on('mousemove', onDragMove)
                            .on('touchmove', onDragMove)
                            .on('tap', onClick)
                            .on('click', onClick);

                        gameSceneU.displayGroup = letterLayer;
                        stage.addChild(gameSceneU);
                        gameSceneU.pivot.set(gameSceneU.width/2, gameSceneU.height/2);
                        gameSceneU.updateTransform();
                    }

                    function setupLetterP() {

                        //Create the sprites
                        gameSceneP = new Container();
                        gameSceneP.interactive = true;
                        gameSceneP.x = MINI_GRID_INDENDATION + defaultIndentation * 39;
                        gameSceneP.y = gridHeight + GRID_INDENTATION_Y + defaultIndentation * 9;
                        gameSceneP.filter = { name: "P", id: 12, x: gameSceneP.x, y: gameSceneP.y, statusPosition: 0 };
                        gameSceneP.rotation = 0;
                        gameSceneP.zIndex = 0;

                        resource = resources["images/blockp.png"].texture;
                        var block1 = new Sprite(resource);
                        var block2 = new Sprite(resource);
                        var block3 = new Sprite(resource);
                        var block4 = new Sprite(resource);
                        var block5 = new Sprite(resource);

                        gameSceneP.addChild(block1);
                        block1.position.y = 0;
                        block1.position.x = 0;

                        gameSceneP.addChild(block2);
                        block2.position.y = 0;
                        block2.position.x = block1.height - minPixel;

                        gameSceneP.addChild(block3);
                        block3.position.y = block2.height - minPixel;
                        block3.position.x = 0;

                        gameSceneP.addChild(block4);
                        block4.position.y = block3.height - minPixel;
                        block4.position.x = block3.width - minPixel;

                        gameSceneP.addChild(block5);
                        block5.position.y = (block4.height - minPixel) + (block4.height - minPixel);
                        block5.position.x = 0;

                        // setup events
                        gameSceneP.on('mousedown', onDragStart)
                            .on('touchstart', onDragStart)
                            .on('mouseup', onDragEnd)
                            .on('mouseupoutside', onDragEnd)
                            .on('touchend', onDragEnd)
                            .on('touchendoutside', onDragEnd)
                            .on('mousemove', onDragMove)
                            .on('touchmove', onDragMove)
                            .on('tap', onClick)
                            .on('click', onClick);
                        
                        gameSceneP.displayGroup = letterLayer;
                        stage.addChild(gameSceneP);

                        gameSceneP.pivot.set(gameSceneP.width/2, gameSceneP.height/2);
                        gameSceneP.updateTransform();

                    }

                    function onDragStart(event) {
                        closeMenuOption();
                        // store a reference to the data the reason for this is because of multitouch we want to track the movement of this particular touch
                        this.start_data = {x: event.data.originalEvent.screenX, y: event.data.originalEvent.screenY};
                        this.data = event.data;
                        this.alpha = 0.5;
                        this.oldGroup = this.displayGroup;
                        this.displayGroup = dragLayer;
                        this.dragging = true;
                        // this.zIndex = 1;
                        unCheck(event.currentTarget.children, this.filter);
                        countCheckGrid();
                    }   

                    function onDragEnd(event) {

                        var ev_data = event.data.originalEvent;

                        this.alpha = 1;

                        this.dragging = false;
                        this.displayGroup = this.oldGroup;

                        if (this.start_data) {
                            if (Math.abs(this.start_data.x - ev_data.screenX) > 2 || Math.abs(this.start_data.y - ev_data.screenY) > 2) {
                                event.stopPropagation();
                            }
                        }

                        // set the interaction data to null
                        this.data = null;

                        // this.zIndex = 0;

                        event.currentTarget.calculateBounds();
                        var points = check(event.currentTarget.children, this.filter);

                        if(points.x == 0){
                            this.alpha = 0.5;
                            this.filter.statusPosition = 2; // Position is not valid
                        }
                        else{
                            this.position.x = points.x;
                            this.position.y = points.y;
                            this.filter.statusPosition = 1; // Position is valid
                        }
                        countCheckGrid();
                    }

                    function onDragMove(event) {
                        if (this.dragging)
                        {
                            verifyStatusPosition(this.filter);
                            this.position.x += this.data.originalEvent.movementX;
                            this.position.y += this.data.originalEvent.movementY;
                            contain(event.currentTarget, {x : defaultIndentation, y : defaultIndentation, width : renderer.width, height: renderer.height});
                        }
                    }

                    function onClick(event)
                    {
                        if(KeyPress == 0){
                            unCheck(this.children, this.filter);
                            this.rotation += Math.PI / 2;
                            
                        }
                        else{
                            unCheck(this.children, this.filter);
                            this.scale.x *= -1;
                        }

                        event.currentTarget.updateTransform();
                        event.currentTarget.calculateBounds();
                        var points = check(event.currentTarget.children, this.filter);
                        if(points.x == 0){
                            this.alpha = 0.5;
                            this.filter.statusPosition = 2; // Position is not valid
                        }
                        else{
                            this.alpha = 1;
                            this.position.x = points.x;
                            this.position.y = points.y;
                            this.filter.statusPosition = 1; // Position is valid
                        }
                        countCheckGrid();
                    }

                    function onClickMiniGrid(event)
                    {
                        //clear selected grid
                        for(var i = 0; i < miniGridContainer.children.length; i++){
                            miniGridContainer.children[i].filter.selected = false;
                        }

                        //selected grid
                        this.filter.selected = true;
                        currentGrid = event.currentTarget;
                        var filter = currentGrid.filter;
                        stage.removeChild(gridWinner);
                        if (filter.status == "not_winner") {
                            rowSelected = filter.row;
                            columnSelected = filter.column;
                            drawAllRectGridBackground();
                            drawBackgroundRectMiniGrid(currentGrid.x, currentGrid.y, currentGrid.width, currentGrid.height);
                            initAllPositions();
                        }
                        
                    }

                    function initAllPositions() {
                        for (var c = 0; c < stage.children.length; c ++){
                            var child = stage.children[c];
                            if (child.children.length == 5) {
                                child.x = child.filter.x;
                                child.y = child.filter.y;
                                child.rotation = 0;
                            }
                        }
                    }

                    function check(children, filter){

                        var points = new Array();
                        
                        for(var c = 0; c < children.length; c++){

                            var boundsChild = children[c]._bounds;
                            
                            var xmin = boundsChild.minX;
                            var xmax = boundsChild.maxX;
                            var ymin = boundsChild.minY;
                            var ymax = boundsChild.maxY;
                            var centerX = xmin + defaultIndentation;
                            var centerY = ymin + defaultIndentation;
                            
                            for(var i = 0; i < matrixGrid.length; i++){
                                if( matrixGrid[i].minX <= centerX && centerX <= matrixGrid[i].maxX && matrixGrid[i].minY <= centerY && centerY <= matrixGrid[i].maxY && matrixGrid[i].check === false) {
                                    points.push(
                                        {
                                             x: matrixGrid[i].centerX, 
                                             y: matrixGrid[i].centerY, 
                                             minX:matrixGrid[i].minX, 
                                             minY: matrixGrid[i].minY, 
                                             maxX: matrixGrid[i].maxX, 
                                             maxY: matrixGrid[i].maxY, 
                                             indexMatrix: i, 
                                             idLetters: filter.id  
                                        }
                                        );
                                }
                            }
                        }

                        // countCheckGrid();
                        console.log("point len -> "+points.length);
                        if(points.length == 5){
                            for(var i = 0; i < points.length; i++){
                                matrixGrid[points[i].indexMatrix].check = true;
                                matrixGrid[points[i].indexMatrix].idLetters = filter.id;
                            }
                            return findCenter(points);
                        }  
                        else{
                            console.log("position failed");
                            return { x: 0, y: 0 };
                        }
                        
                    }

                    function unCheck(children, filter){
                        for(var c = 0; c < children.length; c++){
                            var boundsChild = children[c]._bounds;
                            // console.log("BoundsElement -> "+JSON.stringify(boundsChild));

                            var xmin = boundsChild.minX;
                            var xmax = boundsChild.maxX;
                            var ymin = boundsChild.minY;
                            var ymax = boundsChild.maxY;
                            var centerX = xmin + defaultIndentation;
                            var centerY = ymin + defaultIndentation;
                            
                            for(var i = 0; i < matrixGrid.length; i++){
                                // console.log("BoundsGrid -> "+JSON.stringify(matrixGrid[i]));
                                if( matrixGrid[i].minX <= centerX && centerX <= matrixGrid[i].maxX && matrixGrid[i].minY <= centerY && centerY <= matrixGrid[i].maxY && matrixGrid[i].idLetters == filter.id ) {
                                    matrixGrid[i].idLetters = 0;
                                    matrixGrid[i].check = false;
                                    // console.log("achou -> "+JSON.stringify(matrixGrid[i]));    
                                }
                            }
                        }
                    }

                    function countCheckGrid(){
                        
                        var count = 0;
                        var countFalse = 0;;

                        for(var i = 0; i < matrixGrid.length; i++){
                            if( matrixGrid[i].check == true ) {
                                count++;
                            }
                            else{
                                countFalse++;
                            }
                        }

                        if (count == 60 || (currentGrid != null && currentGrid.filter.status == "winner")) {
                            currentGrid.filter.status = "winner";
                            if(gridWinner != null){
                                stage.removeChild(gridWinner);
                            }
                            gridWinner = new Container();
                            resource = resources["images/grid_win_temp.png"].texture;
                            var grid = new Sprite(resource);
                            gridWinner.addChild(grid);
                            stage.addChild(gridWinner);

                            gridWinner.x = GRID_INDENTATION;
                            gridWinner.y = GRID_INDENTATION_Y;

                            var checkContainer = new Container();
                            resource = resources["images/check.png"].texture;
                            var check = new Sprite(resource);
                            check.width = 20;
                            check.height = 20;
                            checkContainer.addChild(check);
                            checkContainer.x = currentGrid.x;
                            checkContainer.y = currentGrid.y;
                            stage.addChild(checkContainer);

                            winnerGridGraphics = new PIXI.Graphics();
                            winnerGridGraphics.beginFill(0x5F9E5D);
                            winnerGridGraphics.alpha = 0.6;
                            // draw a rectangle
                            winnerGridGraphics.drawRect(currentGrid.x, currentGrid.y, currentGrid.width,currentGrid.height);
                            winnerGridGraphics.endFill();

                            stage.addChild(winnerGridGraphics);
                        } else {
                            stage.removeChild(gridWinner);
                        }
                    }

                    function findCenter(points) {

                        var len = points.length;
                        var arrayX = new Array();
                        var arrayY = new Array();

                        for (i = 0; i < len; i++) {
                            arrayX.push(points[i].minX);
                            arrayX.push(points[i].maxX);
                            arrayY.push(points[i].minY);
                            arrayY.push(points[i].maxY);
                        }

                        var yMin = Math.min.apply(Math, arrayY);
                        var yMax = Math.max.apply(Math, arrayY);

                        var xMin = Math.min.apply(Math, arrayX);
                        var xMax = Math.max.apply(Math, arrayX);

                        var yInterval = yMax - yMin;
                        var xInterval = xMax - xMin;

                        var newX = (xMin + xInterval / 2);
                        var newY = (yMin + yInterval / 2);

                        return { x: newX, y: newY };
                    }

                    function verifyStatusPosition(filter){
                        var letters = stage.children;

                        for(var i=0; i < letters.length; i++){
                            if(letters[i].filter != undefined){
                                if(letters[i].filter.statusPosition == 2){
                                    if(letters[i].filter.id != filter.id){
                                        console.log("Name Letter->" + letters[i].filter.name);
                                        stage.children[i].filter.statusPosition = 0; // Position default
                                        stage.children[i].rotation = 0;
                                        stage.children[i].alpha = 1;
                                        stage.children[i].position.x = letters[i].filter.x;
                                        stage.children[i].position.y = letters[i].filter.y;
                                    }
                                }
                                
                            }
                        }
                    }

                    function keyPressed(evt){
                        evt = evt || window.event;
                        var key = evt.keyCode || evt.which;
                        return key;
                    }

                    function resetGameGridSelected(event){
                        
                        for(var i = 0; i < miniGridContainer.children.length; i++){
                            if(miniGridContainer.children[i].filter.selected == true){
                                console.log("grid -> "+JSON.stringify(miniGridContainer.children[i].filter));
                                currentGrid = miniGridContainer.children[i];
                                var filter = currentGrid.filter;
                                stage.removeChild(gridWinner);
                                if (filter.status == "not_winner") {
                                    rowSelected = filter.row;
                                    columnSelected = filter.column;
                                    drawAllRectGridBackground();
                                    drawBackgroundRectMiniGrid(currentGrid.x, currentGrid.y, currentGrid.width, currentGrid.height);
                                    initAllPositions();
                                }
                                else{
                                    
                                }
                            }
                        }
                    }

                    // run the render loop
                    animate();

                    function animate()
                    {
                        renderer.render(stage);
                        requestAnimationFrame( animate );
                    }

                    window.addEventListener("resize", function(event){ 
                        scaleToWindow(renderer.view);
                    });

                   
                    function contain(sprite, container) 
                    {
                        
                        var collision = undefined;
                        sprite.calculateBounds(); 

                        var rotation = Math.ceil(sprite.rotation);
                        var bounds = sprite._bounds;
                        var yInterval = bounds.maxY - bounds.minY;
                        var xInterval = bounds.maxX - bounds.minX; 
                    
                        //Left
                        if (bounds.minX < 0.5) {
                            sprite.x = 0.5 + xInterval/2;
                            collision = "left";
                        }

                        //Top
                        if (bounds.minY < 0.5) {
                            sprite.y = 0.5 + yInterval/2;
                            collision = "top";
                        }

                        //Right
                        if (bounds.maxX > container.width) {
                            sprite.x = container.width - xInterval/2;
                            collision = "right";
                        }
                        //Bottom
                        if (bounds.maxY > container.height) {
                            sprite.y = container.height - yInterval/2;
                            collision = "bottom";
                        }

                        return collision;
                    }

            </script>
      <!-- </body> -->

    <!-- jQuery first, then Tether, then Bootstrap JS. -->
    <!-- <script src="https://code.jquery.com/jquery-3.1.1.slim.min.js" integrity="sha384-A7FZj7v+d/sdmMqp/nOQwliLvUsJfDHW+k9Omg/a/EheAdgtzNs3hpfag6Ed950n" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script> -->

</html>
